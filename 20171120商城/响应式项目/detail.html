<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
	</head>
	<body>
		<p class="search"> 
			<input type="text" id="search"/>
			<input type="button" id="btn" value="搜索"/>
		</p>
		<ul id="box"></ul>
		
		
		<button id="cart">加入购物车</button>
		
		
		
		<script src="js/jquery-1.12.3.min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			
		var str = location.search.substr(1);
		
		var goodId = str.split("=");
		
		
		$.ajax({
			"url": "http://h6.duchengjiu.top/shop/api_goods.php",
			"type": "GET",
			"data": {
				"goods_id": goodId[1]
			},
			"dataType": "json",
			"success": function(response){
				console.log(response);
				
				var obj = response;
			
				for(var i=0;i<obj.data.length;i++){
					
					
					$("#box").append('<li><img src="' + obj.data[i].goods_thumb + '" alt="" /><p><a href="detail.html?goods_id='+obj.data[i].goods_id+'">商品名称:' +obj.data[i].goods_name+ '</a></p><p>商品简介:' +obj.data[i].goods_desc+  '</p><p class="price">商品价格:￥' +obj.data[i].price+  '</p></li>');
					$("#cart").click(function(){
						if(!localStorage.getItem("token")){
							alert("请登录");
							location.href="login.html#callback="+location.href;
						}
						var goods_number = localStorage.getItem("cart"+goodId[1]);
			
						goods_number = goods_number ? parseInt(goods_number)+1 : 1;
						
						$.ajax({
							"url":"http://h6.duchengjiu.top/shop/api_cart.php?token=" + localStorage.getItem("token"),
							"type":"POST",
							"dataType": "json",
							"data": {
								"goods_id" : goodId[1],
								"number"   : goods_number
							},
							"success": function(response){
								console.log(response);
								
								localStorage.setItem("cart"+ goodId[1],goods_number);
								
							}
						});

					})
					
				}
			}
		})
			
		
		$("#btn").click(function(){
			
			var strNew = $("#search").val();
			
			console.log(strNew);
			
			$.ajax({
				"url": "http://h6.duchengjiu.top/shop/api_goods.php",
				"type": "GET",
				"data": {
					"search_text": strNew
				},
				"dataType": "json",
				"success": function(response){
					console.log(response);
					
					var obj = response;
					var html ='';
					for(var i=0;i<obj.data.length;i++){
						
						
						html+='<li><img src="' + obj.data[i].goods_thumb + '" alt="" /><p><a href="detail.html?goods_id='+obj.data[i].goods_id+'">商品名称:' +obj.data[i].goods_name+ '</a></p><p>商品简介:' +obj.data[i].goods_desc+  '</p><p class="price">商品价格:￥' +obj.data[i].price+  '</p></li>';
						
					}
					
					$("#box").html(html);
				}
			})
		})
			
			
		</script>
	</body>
</html>
